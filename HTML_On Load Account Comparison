<!DOCTYPE html>
<html>
  <head>
  <base target="_blank"/>
    <meta name="viewport" content="width=device-width, initial-scale=1">
  </head>

  <body>
    <div id="messageToUser"></div>
  <header>

  </header> 
  
  <!-- The scriptlet below runs when the HTML Template is evaluated on the server and gets the effective user -->
  <!-- The input tag below is hidden and has the value which is the effective user account -->
  
  <input id="idAccountOfEffectiveUsr" type="text" style="display:none" <?!= getEffectiveUserEM() ?>/>
  
  <script language="javascript">
    //console.log('it ran on load')
    
    window.onload = function() {
      google.script.run
        .withFailureHandler(failedAcctTest)
        .getEffectiveUserEM()
    };

    window.failedAcctTest = function(rtrn) {
      var usrWhoLoaded = document.getElementById('idAccountOfEffectiveUsr').textContent;
      
      if (usrWhoLoaded !== rtrn) {
        document.getElementById('messageToUser').textContent = 'The Add-on loaded under the account: \n\n' + usrWhoLoaded + '\n\nBut you are also logged into ' + 
        'account: ' + rtrn + "\n\nYou are logged into multiple accounts which has caused an authorization error. \n\n" +
        "You must either log out of all accounts, and log back into the account that installed the add-on; or open " +
        "an incognito window, log in and use the add-on from that window";
      }
    }

  </script>
  
  </body>
</html> 
